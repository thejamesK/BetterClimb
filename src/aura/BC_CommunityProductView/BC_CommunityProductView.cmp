<aura:component description="BC_CommunityProductView" access="global" implements="forceCommunity:availableForAllPageTypes,force:hasRecordId" controller="BC_CommunityProductViewController">
    <aura:attribute name="record" type="Object"/>
    <aura:attribute name="simpleRecord" type="Object"/>
    <aura:attribute name="recordError" type="String"/>
    <aura:attribute name="productWrapper" type="BC_ProductWrapper" />
    <aura:attribute name="productRating" type="BC_RatingWrapper" />
    <aura:handler name="init" value="{!this}" action="{!c.init}" />

<!--    <force:recordData aura:id="recordLoader"-->
<!--                      recordId="{!v.recordId}"-->
<!--                      layoutType="FULL"-->
<!--                      targetRecord="{!v.record}"-->
<!--                      targetFields="{!v.simpleRecord}"-->
<!--                      targetError="{!v.recordError}"  />-->

    <aura:handler name="ProductReviewAdded" event="c:BC_ProductReviewAdded" action="{!c.onProductReviewAdded}"/>

    <div>
        <lightning:layout multipleRows="true">
            <lightning:layoutItem size="4" padding="around-small">
                <div class="product-images">
                    <img src="{!v.productWrapper.productImageUrls[0]}" />
                </div>
            </lightning:layoutItem>
            <aura:if isTrue="{!greaterthan(v.productWrapper.productImageUrls.length, 1)}">
            <lightning:layoutItem size="4" padding="around-small">
                <div class="product-images">
                    <img src="{!v.productWrapper.productImageUrls[1]}" />
                </div>
            </lightning:layoutItem>
            </aura:if>
            <aura:if isTrue="{!!greaterthan(v.productWrapper.productImageUrls.length, 1)}">
                <lightning:layoutItem size="4" padding="around-small">
                </lightning:layoutItem>
            </aura:if>
            <lightning:layoutItem size="4" padding="around-small">
                    <div style="display: flex; flex-direction: column; justify-content: space-evenly; height: 20rem;">
                        <div>
                            <div class="slds-text-heading--label" style="font-size: 30px; color: black;">
                                {!v.productWrapper.productName}
                            </div>
                            <div class="slds-text-heading--label" style="font-size: 25px; color: red;">
                                <lightning:formattedNumber value="{!v.productWrapper.productPrice}" currencyCode="EUR" style="currency" />
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div>
                                Quantity:
                            </div>
                            <div style="display: flex;">
                                <div style="width: 5rem; padding-right: 1rem;">
                                    <ui:inputNumber placeholder="1"/>
                                </div>
                                <div>
                                    <lightning:button label="Add to Cart" iconName="utility:cart" variant="brand" />
                                </div>
                            </div>
                        </div>
                    </div>
            </lightning:layoutItem>
            <lightning:layoutItem size="8">
                <div>
                    <hr style="background: darkgray" />
                </div>
            </lightning:layoutItem>
            <aura:if isTrue="{!v.productWrapper.productDescription != null}">
                <lightning:layoutItem size="8">
                    <div class="slds-text-heading--label" style="color: black; font-weight: bold; font-size: 18px;">
                        {!v.productWrapper.productDescription}
                    </div>
                </lightning:layoutItem>
                <lightning:layoutItem size="8">
                    <div>
                        <hr style="background: darkgray" />
                    </div>
                </lightning:layoutItem>
            </aura:if>
            <lightning:layoutItem size="8">
                <div>
                    <aura:if isTrue="{!v.productRating.vote_count != null}">
                        <div style="display: flex; align-content: center; justify-content: center">
                            <div style="display: flex; flex-direction: column; justify-content: center">
                                <div style="font-size: 25px">
                                    Our Users Rating:
                                </div>
                                <div style="font-size: 15px; display: inline-flex; justify-content: center; align-items: center;">
                                    <div>
                                        <img src="{!$Resource.star}" style="width: 30px; height: 30px"/>
                                    </div>
                                    <div style="height: 30px; display: flex; align-items: center;">
                                        <div style="padding-left: 5px; font-weight: bold; font-size: 25px">
                                                {!v.productRating.vote_average}
                                        </div>
                                        <div style="padding-left: 5px; font-size: 13px; color: darkgrey">
                                            on&nbsp;{!v.productRating.vote_count} votes
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aura:if>
                    <aura:if isTrue="{!v.productRating.vote_count == null}">
                        <div style="display: flex; flex-direction: column; font-size: 20px; font-weight: bold; padding-bottom: 3rem;">
                            <div style="display: flex; justify-content: center">
                                No rating on this product :(
                            </div>
                            <div style="display: flex; font-size: 13px; color: darkgrey; font-weight: normal; justify-content: center">
                                Be first one to add review!
                            </div>
                        </div>
                    </aura:if>
                    <aura:if isTrue="{!!empty(v.productWrapper)}">
                        <div>
                            <lightning:tabset aura:id="tabs" class="slds-card">
                                <lightning:tab id="productReviewTab" label="Reviews">
                                    <c:BC_ProductReviews aura:id="reviews" product="{!v.productWrapper}"/>
                                </lightning:tab>
                                <lightning:tab label="Add Review">
                                    <c:BC_AddProductReview product="{!v.productWrapper}" />
                                </lightning:tab>
                            </lightning:tabset>
                        </div>
                    </aura:if>
                </div>
            </lightning:layoutItem>
        </lightning:layout>
    </div>
</aura:component>